!function(e,t){"use strict";e.module("ngSails",["ng"]),function(e,t){function n(t){var n,r,s,i={};return t?(e.forEach(t.split("\n"),function(e){s=e.indexOf(":"),n=lowercase(o(e.substr(0,s))),r=o(e.substr(s+1)),n&&(i[n]=i[n]?i[n]+", "+r:r)}),i):i}function o(t){return e.isString(t)?t.trim():t}function r(t){return t&&e.isFunction(t.then)}function s(t){var o=e.isObject(t)?t:void 0;return function(e){if(o||(o=n(t)),e){var r=o[lowercase(e)];return void 0===r&&(r=null),r}return o}}t.sails&&(t.sails.autoConnect=!1),e.module("ngSails").provider("$sails",function(){var n=this;this.httpVerbs=["get","post","put","delete"],this.eventNames=["on","off"],this.url=void 0,this.urlPrefix="",this.config={transports:["websocket","polling"],useCORSRouteToGetCookie:!1},this.debug=!1;var o=this.interceptors=[];this.$get=["$q","$injector","$rootScope","$log","$timeout",function(i,u,a,c,f){function l(e){function t(){o(null)}function o(t,o){o||(o={body:t,headers:t.headers||{},statusCode:t.statusCode||t.status||0,error:function(){return this.statusCode<200||this.statusCode>=400?this.body||this.statusCode:void 0}()}),o.data=o.body,o.status=o.statusCode,o.socket=g,o.url=e.url,o.method=e.method,o.config=e.config,o.error?(n.debug&&c.warn("$sails response "+o.statusCode+" "+e.url,o),s.reject(o)):(n.debug&&c.info("$sails response "+e.url,o),s.resolve(o))}var s=i.defer();return n.debug&&c.info("$sails "+e.method+" "+e.url,e.data||""),e.timeout>0?f(t,e.timeout):r(e.timeout)&&e.timeout.then(t),g["legacy_"+e.method.toLowerCase()](e.url,e.data,o),s.promise}function d(t){g["legacy_"+t]=g[t],g[t]=function(o,r,u){var a=[l,void 0],c=i.when({url:n.urlPrefix+o,data:r,socket:g,config:u||{},method:t.toUpperCase()});for(e.forEach(v,function(e){(e.request||e.requestError)&&a.unshift(e.request,e.requestError),(e.response||e.responseError)&&a.push(e.response,e.responseError)});a.length;){var f=a.shift(),d=a.shift();c=c.then(f,d)}return c.success=function(e){return c.then(function(t){e(t.body,t.statusCode,s(t.headers),t)}),c},c.error=function(e){return c.then(null,function(t){e(t.body,t.statusCode,s(t.headers),t)}),c},c}}function h(t){(g[t]||g._raw&&g._raw[t])&&(g["legacy_"+t]=g[t]||g._raw[t],g[t]=function(n,o){var r=null;return"off"==t?g["legacy_"+t](n,o):(null!==o&&e.isFunction(o)&&g["legacy_"+t](n,r=function(e){a.$evalAsync(o.bind(g,e))}),r)})}var g=(t.sails&&t.sails.connect||t.connect)(n.url,n.config);g.connect=function(t){if(!g.isConnected()){var o=t||{};o=e.extend({},n.config,t),g.useCORSRouteToGetCookie=o.useCORSRouteToGetCookie,g.url=o.url||n.url,g.multiplex=o.multiplex,g._connect()}return g};var v=[];return e.forEach(o,function(t){v.unshift(e.isString(t)?u.get(t):u.invoke(t))}),g.once=function(t,n){null!==n&&e.isFunction(n)&&g._raw&&g._raw.once(t,function(e){a.$evalAsync(n.bind(g,e))})},e.forEach(n.httpVerbs,d),e.forEach(n.eventNames,h),g.$modelUpdater=function(t,n){var o=function(t){a.$evalAsync(function(){var o;switch(t.verb){case"created":n.push(t.data);break;case"updated":var r;for(o=0;o<n.length;o++)if(n[o].id===t.id){r=n[o];break}if(!r&&!t.previous)return;r||(r=t.previous,n.push(r)),e.extend(r,t.data);break;case"destroyed":for(o=0;o<n.length;o++)if(n[o].id===t.id){n.splice(o,1);break}}})};return g.legacy_on(t,o),function(){g.legacy_off(t,o)}},g}],this.$get.$inject=["$q","$injector","$rootScope","$log","$timeout"]})}(e,t)}(angular,io);